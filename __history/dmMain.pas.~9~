unit dmMain;

interface

uses
  System.SysUtils, System.Classes, REST.Types, REST.Client,
  Data.Bind.Components, Data.Bind.ObjectScope,json;

type
  TdmMainf = class(TDataModule)
    RESTClient: TRESTClient;
    RESTRequest: TRESTRequest;
    RESTResponse: TRESTResponse;
  private
    { Private declarations }
  public
    { Public declarations }
    function GetWeatherData(Alat,Along : string) : string;
  end;

var
  dmMainf: TdmMainf;

implementation

{%CLASSGROUP 'FMX.Controls.TControl'}

{$R *.dfm}

{ TDataModule1 }

function TdmMainf.GetWeatherData(Alat, Along: string): string;
var
  lJsArray : TJSONArray;
  lJsValue, lJsName : TJSONValue;
begin
  RESTClient.BaseURL := 'https://api.open-meteo.com/v1/forecast?latitude='+ Alat+ '&longitude='+ Along
        + '&current=temperature_2m,apparent_temperature,is_day,precipitation,rain,showers,cloud_cover,'
        + 'wind_speed_10m,wind_direction_10m&hourly=temperature_2m&daily=temperature_2m_max,sunrise,'
        + 'sunset,daylight_duration,rain_sum,wind_speed_10m_max&timezone=Asia%2FBangkok';

  RESTRequest.Execute;

  //Get response
  lJsValue := TJSONObject.ParseJSONValue(RESTResponse.Content);
  lJsArray := lJsValue as TJSONArray;
//  for lJsName in lJsArray do
//  begin
//    Result := lJsName.GetValue<string>('');
//  end;
    Result := RESTResponse.Content;

end;

end.
